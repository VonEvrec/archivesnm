<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Dana N'kassa</title>

    <!-- System UI stack for crisp Apple-like type, with fallback -->
    <style>
      /* Base tokens */
      :root {
        --bg-color: #0b0b0b;
        --text-color: #ffffff;
        --muted-color: #9aa0a6;
        --line-color: rgba(255, 255, 255, 0.08);
        --card-border: rgba(255, 255, 255, 0.12);
        --card-bg: rgba(255, 255, 255, 0.03);
        --focus-ring: rgba(255, 255, 255, 0.6);
        --accent: #e5e7eb;
      }

      @font-face {
        font-family: 'pgLang Roman';
        src: url('/fonts/PgLang.woff2') format('woff2'),
          url('/fonts/PgLang.woff') format('woff');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      body {
        font-family: ui-serif, Georgia, 'Times New Roman', Times, serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        letter-spacing: -0.01em;
        line-height: 1.5;
        overflow-x: hidden;
      }

      /* Accessibility: reduce motion if requested */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
          scroll-behavior: auto !important;
        }
      }

      /* Header */
      .header-container {
        position: relative;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        padding: 48px 28px 28px;
        border-bottom: 1px solid var(--line-color);
      }

      .artist-name {
        font-family: 'pgLang Roman', ui-serif, Georgia, serif;
        font-size: clamp(1.6rem, 2vw, 2rem);
        font-weight: 600;
        letter-spacing: 0.02em;
        color: var(--text-color);
      }

      .contact-info {
        font-size: 0.85rem;
        color: var(--muted-color);
        letter-spacing: 0.02em;
        text-align: right;
        cursor: pointer;
        position: relative;
        padding-bottom: 6px;
        transition: color 180ms ease;
      }

      .contact-info::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 1px;
        background: currentColor;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 220ms cubic-bezier(0.16, 1, 0.3, 1);
        opacity: 0.7;
      }

      .contact-info:hover {
        color: var(--text-color);
      }
      .contact-info:hover::after {
        transform: scaleX(1);
      }

      /* Main */
      .main-content {
        display: flex;
        flex-grow: 1;
        width: 100%;
        padding: 12px 0 0;
        box-sizing: border-box;
      }

      .music-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 100%;
        max-width: 980px;
        margin: 0 auto 40px;
        padding: 0 28px;
      }

      .music-item {
        position: relative;
        transition: transform 160ms ease, opacity 160ms ease;
      }

      .music-item + .music-item {
        border-top: 1px solid var(--line-color);
        padding-top: 18px;
      }

      .music-header {
        display: flex;
        align-items: baseline;
        gap: 96px;
        position: relative;
        z-index: 1;
      }

      .track-name {
        font-family: ui-sans-serif, system-ui, -apple-system, 'Segoe UI',
          Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
        font-size: 0.82rem;
        color: var(--muted-color);
        font-weight: 500;
        min-width: 140px;
        flex-shrink: 0;
        letter-spacing: 0.04em;
        opacity: 0.95;
        cursor: pointer;
        position: relative;
        transition: color 180ms ease;
      }
      .track-name::after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 100%;
        height: 1px;
        background: currentColor;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 220ms cubic-bezier(0.16, 1, 0.3, 1);
        opacity: 0.6;
      }
      .track-name:hover {
        color: var(--text-color);
      }
      .track-name:hover::after {
        transform: scaleX(1);
      }

      /* Reveal content */
      .content {
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transition: max-height 300ms ease, opacity 300ms ease,
          transform 300ms ease, margin 300ms ease;
        transform: translateY(-6px);
        pointer-events: none;
        margin-left: 180px;
        position: relative;
        z-index: 0;
        width: calc(100% - 180px);
      }

      .content.open {
        max-height: 320px;
        opacity: 1;
        transform: translateY(0);
        margin-top: 16px;
        margin-bottom: 12px;
        pointer-events: auto;
      }

      /* Card/Player */
      .audio-player {
        display: flex;
        align-items: center;
        gap: 18px;
        border: 1px solid var(--card-border);
        border-radius: 16px;
        padding: 18px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.06) 0%,
          rgba(255, 255, 255, 0.02) 100%
        );
        backdrop-filter: blur(6px);
        will-change: transform, opacity;
      }

      .play-button {
        width: 40px;
        height: 40px;
        border: 1px solid rgba(255, 255, 255, 0.28);
        background: transparent;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease,
          background-color 120ms ease;
        position: relative;
        overflow: hidden;
      }
      .play-button:hover {
        border-color: var(--focus-ring);
        background: rgba(255, 255, 255, 0.08);
        transform: scale(1.04);
      }
      .play-button:active {
        transform: scale(0.98);
      }
      .play-icon,
      .pause-icon {
        position: absolute;
        color: var(--text-color);
        font-size: 12px;
        line-height: 1;
        transition: opacity 120ms ease, transform 120ms ease;
        pointer-events: none;
      }
      .play-icon {
        opacity: 1;
        transform: scale(1);
        margin-left: 1px;
      }
      .pause-icon {
        opacity: 0;
        transform: scale(0.8);
      }
      .play-button.playing .play-icon {
        opacity: 0;
        transform: scale(0.8);
      }
      .play-button.playing .pause-icon {
        opacity: 1;
        transform: scale(1);
      }

      .audio-controls {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .progress-container {
        width: 100%;
        height: 2px;
        background-color: rgba(255, 255, 255, 0.16);
        border-radius: 2px;
        cursor: pointer;
        position: relative;
        transition: height 120ms ease, background-color 120ms ease;
      }
      .progress-container:hover {
        height: 3px;
        background-color: rgba(255, 255, 255, 0.22);
      }
      .progress-bar {
        height: 100%;
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 2px;
        width: 0%;
        transition: width 60ms linear;
      }

      .time-display {
        display: flex;
        justify-content: space-between;
        font-size: 0.72rem;
        color: var(--muted-color);
        gap: 8px;
      }

      .loop-button {
        width: 30px;
        height: 30px;
        border: 1px solid rgba(255, 255, 255, 0.22);
        background: transparent;
        border-radius: 50%;
        color: var(--muted-color);
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease, color 120ms ease,
          background-color 120ms ease;
        font-size: 11px;
        flex-shrink: 0;
        opacity: 0.85;
      }
      .loop-button:hover {
        border-color: rgba(255, 255, 255, 0.38);
        color: var(--text-color);
        transform: scale(1.05);
      }
      .loop-button.active {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.5);
        color: var(--text-color);
        transform: scale(1.08);
      }

      /* Minimal visualizer */
      .visualizer {
        width: 180px;
        height: 36px;
        border-radius: 10px;
        background: var(--card-bg);
        border: 1px solid var(--line-color);
        overflow: hidden;
        flex-shrink: 0;
      }
      .visualizer canvas {
        display: block;
        width: 100%;
        height: 100%;
      }

      audio {
        display: none;
      }

      footer {
        text-align: center;
        padding: 28px 20px 40px;
        font-size: 0.78rem;
        color: var(--muted-color);
        letter-spacing: 0.02em;
        margin-top: auto;
        border-top: 1px solid var(--line-color);
      }

      /* Responsive */
      @media (max-width: 900px) {
        .content {
          margin-left: 120px;
          width: calc(100% - 120px);
        }
      }

      @media (max-width: 680px) {
        .header-container {
          padding: 36px 20px 22px;
          flex-direction: column;
          gap: 12px;
          align-items: flex-start;
        }
        .artist-name {
          font-size: 1.5rem;
        }
        .music-header {
          flex-direction: column;
          gap: 8px;
        }
        .content {
          margin-left: 0;
          width: 100%;
        }
        .audio-player {
          padding: 14px;
          gap: 14px;
        }
        .play-button {
          width: 42px;
          height: 42px;
        }
        .visualizer {
          width: 140px;
          height: 32px;
        }
      }

      /* Touch optimizations */
      * {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        user-select: none;
      }
      button,
      .track-name,
      .contact-info {
        touch-action: manipulation;
      }
      .track-name:focus-visible,
      .play-button:focus-visible,
      .loop-button:focus-visible,
      .contact-info:focus-visible {
        outline: none;
        box-shadow: 0 0 0 2px var(--focus-ring);
        border-radius: 8px;
      }
    </style>
  </head>

  <body>
    <div class="header-container">
      <div class="artist-name">𝐃𝐀𝐍𝐀 𝐍'𝐊𝐀𝐒𝐒𝐀</div>
      <div class="contact-info">contact.danankassa@gmail.com</div>
    </div>

    <div class="main-content">
      <div class="music-list">
        <!-- Items -->
        <div class="music-item">
          <div class="music-header">
            <div class="track-name toggle" data-audio="NM-205.mp3">NM-205</div>
          </div>
          <div class="content">
            <div class="audio-player">
              <button class="play-button" aria-label="Lire ou mettre en pause">
                <span class="play-icon">▶</span>
                <span class="pause-icon">⏸</span>
              </button>

              <div class="audio-controls">
                <div class="progress-container" aria-label="Barre de progression">
                  <div class="progress-bar"></div>
                </div>
                <div class="time-display">
                  <span class="current-time">0:00</span>
                  <span class="total-time">0:00</span>
                </div>
              </div>

              <div class="visualizer" aria-hidden="true">
                <canvas></canvas>
              </div>

              <button class="loop-button" aria-pressed="false" aria-label="Boucle">⟲</button>
              <audio preload="none" crossorigin="anonymous"></audio>
            </div>
          </div>
        </div>

        <!-- Duplicate the same pattern for all tracks -->
        <div class="music-item">
          <div class="music-header">
            <div class="track-name toggle" data-audio="NM-209.mp3">NM-209</div>
          </div>
          <div class="content">
            <div class="audio-player">
              <button class="play-button" aria-label="Lire ou mettre en pause">
                <span class="play-icon">▶</span>
                <span class="pause-icon">⏸</span>
              </button>
              <div class="audio-controls">
                <div class="progress-container">
                  <div class="progress-bar"></div>
                </div>
                <div class="time-display">
                  <span class="current-time">0:00</span>
                  <span class="total-time">0:00</span>
                </div>
              </div>
              <div class="visualizer"><canvas></canvas></div>
              <button class="loop-button" aria-pressed="false" aria-label="Boucle">⟲</button>
              <audio preload="none" crossorigin="anonymous"></audio>
            </div>
          </div>
        </div>

        <!-- Continue all your items exactly as before -->
        <div class="music-item">
          <div class="music-header">
            <div class="track-name toggle" data-audio="NM-208.mp3">NM-208</div>
          </div>
          <div class="content">
            <div class="audio-player">
              <button class="play-button" aria-label="Lire ou mettre en pause">
                <span class="play-icon">▶</span>
                <span class="pause-icon">⏸</span>
              </button>
              <div class="audio-controls">
                <div class="progress-container">
                  <div class="progress-bar"></div>
                </div>
                <div class="time-display">
                  <span class="current-time">0:00</span>
                  <span class="total-time">0:00</span>
                </div>
              </div>
              <div class="visualizer"><canvas></canvas></div>
              <button class="loop-button" aria-pressed="false" aria-label="Boucle">⟲</button>
              <audio preload="none" crossorigin="anonymous"></audio>
            </div>
          </div>
        </div>

        <!-- ... replicate for all remaining tracks ... -->
        <!-- NM-197, NM-153, NM-155, NM-157, NM-156, NM-158, NM-120, NM-092, NM-087, NM-046, NM-027, NM-044, NM-042, NM-064, NM-084, NM-079, NM-073, NM-072, NM-020, NM-037 -->
      </div>
    </div>

    <footer>© Dana N'kassa</footer>

    <script>
      // Basic hardening
      document.addEventListener('contextmenu', (e) => {
        if (e.target.tagName === 'AUDIO' || e.target.closest('.audio-player')) {
          e.preventDefault();
        }
      });

      document.addEventListener('keydown', (e) => {
        const blocked =
          (e.ctrlKey || e.metaKey) &&
          (e.key.toLowerCase() === 's' ||
            e.key.toLowerCase() === 'u' ||
            (e.shiftKey && e.key.toLowerCase() === 'i'));
        if (blocked || e.key === 'F12') {
          e.preventDefault();
        }
      });

      // Obfuscate URL with ephemeral params
      function obfuscateAudioSrc(originalSrc) {
        const ts = Date.now();
        const rnd = Math.random().toString(36).slice(2, 8);
        // Keep your existing path expectations; just add query noise
        return originalSrc + '?t=' + ts + '&r=' + rnd;
      }

      function formatTime(seconds) {
        if (isNaN(seconds)) return '0:00';
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return m + ':' + (s < 10 ? '0' : '') + s;
      }

      function clamp(v, min, max) {
        return Math.max(min, Math.min(max, v));
      }

      let currentlyPlaying = null;
      let currentVisualizer = null;

      // Visualizer via Web Audio API (minimal bars)
      function setupVisualizer(audioEl, canvas) {
        try {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          const ctx = new AudioCtx();
          const source = ctx.createMediaElementSource(audioEl);
          const analyser = ctx.createAnalyser();
          analyser.fftSize = 256;
          analyser.smoothingTimeConstant = 0.85;

          source.connect(analyser);
          analyser.connect(ctx.destination);

          const c = canvas;
          const dpr = Math.ceil(window.devicePixelRatio || 1);
          const width = c.clientWidth;
          const height = c.clientHeight;
          c.width = width * dpr;
          c.height = height * dpr;
          const g = c.getContext('2d');
          g.scale(dpr, dpr);

          const bufferLength = analyser.frequencyBinCount;
          const dataArray = new Uint8Array(bufferLength);

          const bars = 24; // minimalist number of bars
          const gap = 3;
          const barWidth = (width - gap * (bars - 1)) / bars;

          let rafId = null;

          function draw() {
            analyser.getByteFrequencyData(dataArray);
            g.clearRect(0, 0, width, height);

            // Subtle gradient like refined Apple feel
            const grad = g.createLinearGradient(0, 0, 0, height);
            grad.addColorStop(0, 'rgba(255,255,255,0.85)');
            grad.addColorStop(1, 'rgba(255,255,255,0.25)');
            g.fillStyle = grad;

            for (let i = 0; i < bars; i++) {
              // Sample evenly across spectrum
              const idx = Math.floor((i / bars) * bufferLength);
              const val = dataArray[idx] / 255;
              const h = clamp(val * height, 2, height);
              const x = i * (barWidth + gap);
              const y = height - h;
              const radius = 4;
              // Rounded bars
              g.beginPath();
              g.moveTo(x, y + radius);
              g.arcTo(x, y, x + radius, y, radius);
              g.lineTo(x + barWidth - radius, y);
              g.arcTo(x + barWidth, y, x + barWidth, y + radius, radius);
              g.lineTo(x + barWidth, y + h - radius);
              g.arcTo(
                x + barWidth,
                y + h,
                x + barWidth - radius,
                y + h,
                radius
              );
              g.lineTo(x + radius, y + h);
              g.arcTo(x, y + h, x, y + h - radius, radius);
              g.closePath();
              g.fill();
            }

            rafId = requestAnimationFrame(draw);
          }

          // Start only when playing
          audioEl.addEventListener('play', () => {
            ctx.resume && ctx.resume();
            if (!rafId) {
              rafId = requestAnimationFrame(draw);
            }
          });
          audioEl.addEventListener('pause', () => {
            if (rafId) {
              cancelAnimationFrame(rafId);
              rafId = null;
            }
            // Soft fade on pause: clear
            g.clearRect(0, 0, width, height);
          });
          audioEl.addEventListener('ended', () => {
            if (rafId) {
              cancelAnimationFrame(rafId);
              rafId = null;
            }
            g.clearRect(0, 0, width, height);
          });

          return { ctx, analyser, stop: () => cancelAnimationFrame(rafId) };
        } catch (e) {
          // Fail silently; player still works without visualizer
          return null;
        }
      }

      function resetAudioPlayer(content) {
        const audio = content.querySelector('audio');
        const playButton = content.querySelector('.play-button');
        const progressBar = content.querySelector('.progress-bar');
        const currentTimeSpan = content.querySelector('.current-time');
        const totalTimeSpan = content.querySelector('.total-time');
        const loopButton = content.querySelector('.loop-button');
        const canvas = content.querySelector('.visualizer canvas');

        if (audio) {
          audio.pause();
          audio.currentTime = 0;
          audio.src = '';
        }

        playButton.classList.remove('playing');
        progressBar.style.width = '0%';
        currentTimeSpan.textContent = '0:00';
        totalTimeSpan.textContent = '0:00';
        loopButton.classList.remove('active');
        loopButton.setAttribute('aria-pressed', 'false');

        // clear visualizer
        if (canvas) {
          const g = canvas.getContext('2d');
          if (g) g.clearRect(0, 0, canvas.width, canvas.height);
        }
      }

      // Init toggles
      document.querySelectorAll('.toggle').forEach((toggle) => {
        toggle.addEventListener('click', (e) => {
          e.preventDefault();
          const parent = toggle.closest('.music-item');
          const content = parent.querySelector('.content');
          const audio = content.querySelector('audio');
          const playButton = content.querySelector('.play-button');
          const progressBar = content.querySelector('.progress-bar');
          const progressContainer = content.querySelector('.progress-container');
          const currentTimeSpan = content.querySelector('.current-time');
          const totalTimeSpan = content.querySelector('.total-time');
          const loopButton = content.querySelector('.loop-button');
          const canvas = content.querySelector('.visualizer canvas');

          const isOpen = content.classList.contains('open');

          // Close others
          document.querySelectorAll('.content.open').forEach((oc) => {
            if (oc !== content) {
              oc.classList.remove('open');
              resetAudioPlayer(oc);
            }
          });

          if (!isOpen) {
            resetAudioPlayer(content);
            const secureAudioSrc = obfuscateAudioSrc(toggle.dataset.audio);
            audio.src = secureAudioSrc;
            audio.controlsList = 'nodownload noremoteplayback nofullscreen';
            audio.disablePictureInPicture = true;
            audio.preload = 'none';

            // Setup visualizer (once)
            if (!audio.__vizAttached) {
              const viz = setupVisualizer(audio, canvas);
              audio.__vizAttached = viz;
            }

            // Metadata
            audio.addEventListener(
              'loadedmetadata',
              () => {
                totalTimeSpan.textContent = formatTime(audio.duration);
              },
              { once: true }
            );

            // Time/progress
            let raf = null;
            function updateProgress() {
              const progress = (audio.currentTime / audio.duration) * 100;
              progressBar.style.width = (isFinite(progress) ? progress : 0) + '%';
              currentTimeSpan.textContent = formatTime(audio.currentTime);
              raf = null;
            }
            audio.addEventListener('timeupdate', () => {
              if (!raf) raf = requestAnimationFrame(updateProgress);
            });

            // Seek
            progressContainer.addEventListener('click', (evt) => {
              const rect = progressContainer.getBoundingClientRect();
              const ratio = clamp((evt.clientX - rect.left) / rect.width, 0, 1);
              if (isFinite(audio.duration)) {
                audio.currentTime = ratio * audio.duration;
              }
            });

            // Loop toggle
            loopButton.addEventListener('click', (evt) => {
              evt.preventDefault();
              const newLoop = !audio.loop;
              audio.loop = newLoop;
              loopButton.classList.toggle('active', newLoop);
              loopButton.setAttribute('aria-pressed', String(newLoop));
            });

            // Play/pause control
            let isProcessing = false;
            playButton.addEventListener('click', async (evt) => {
              evt.preventDefault();
              evt.stopPropagation();
              if (isProcessing) return;
              isProcessing = true;
              try {
                if (audio.paused) {
                  // Stop other audio
                  if (currentlyPlaying && currentlyPlaying !== audio) {
                    currentlyPlaying.pause();
                    document
                      .querySelectorAll('.play-button.playing')
                      .forEach((btn) => btn.classList.remove('playing'));
                  }
                  playButton.classList.add('playing');
                  await audio.play();
                  currentlyPlaying = audio;
                } else {
                  playButton.classList.remove('playing');
                  audio.pause();
                  if (currentlyPlaying === audio) currentlyPlaying = null;
                }
              } catch {
                playButton.classList.remove('playing');
                if (currentlyPlaying === audio) currentlyPlaying = null;
              } finally {
                setTimeout(() => (isProcessing = false), 100);
              }
            });

            // Auto play on reveal if possible
            audio.addEventListener(
              'canplay',
              async () => {
                try {
                  playButton.classList.add('playing');
                  await audio.play();
                  currentlyPlaying = audio;
                } catch {
                  // Require user interaction
                }
              },
              { once: true }
            );

            content.classList.add('open');
            audio.load();
          } else {
            content.classList.remove('open');
            resetAudioPlayer(content);
            if (currentlyPlaying && currentlyPlaying === audio) {
              currentlyPlaying = null;
            }
          }
        });
      });

      // Soft masking of audio.src when inspected (best-effort)
      window.addEventListener('load', () => {
        document.querySelectorAll('audio').forEach((audio) => {
          audio.addEventListener('loadstart', () => {
            try {
              Object.defineProperty(audio, 'src', {
                configurable: true,
                enumerable: false,
                get: () => '[PROTECTED]',
                set: (value) => {
                  audio.setAttribute('src', value);
                },
              });
            } catch {}
          });
        });
      });
    </script>
  </body>
</html>
